<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>结构体与方法 | Go 语言笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?ce26c35c5c5403057ebddcb99965920a";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.77dfaa16.css" as="style"><link rel="preload" href="/assets/js/app.7d3f5bbc.js" as="script"><link rel="preload" href="/assets/js/2.9a822252.js" as="script"><link rel="preload" href="/assets/js/14.523577e2.js" as="script"><link rel="prefetch" href="/assets/js/10.002b5db1.js"><link rel="prefetch" href="/assets/js/11.9885edd0.js"><link rel="prefetch" href="/assets/js/12.15d6ea64.js"><link rel="prefetch" href="/assets/js/13.623d7e6d.js"><link rel="prefetch" href="/assets/js/15.997680bd.js"><link rel="prefetch" href="/assets/js/16.54d68b9b.js"><link rel="prefetch" href="/assets/js/3.5e04ea21.js"><link rel="prefetch" href="/assets/js/4.e05c873c.js"><link rel="prefetch" href="/assets/js/5.33233bc0.js"><link rel="prefetch" href="/assets/js/6.498ab014.js"><link rel="prefetch" href="/assets/js/7.614789a9.js"><link rel="prefetch" href="/assets/js/8.94349a7b.js"><link rel="prefetch" href="/assets/js/9.7c4bd076.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77dfaa16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Go 语言笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/variable.html" class="sidebar-link">变量与常量</a></li><li><a href="/basic/modules.html" class="sidebar-link">模块化</a></li><li><a href="/basic/array.html" class="sidebar-link">数组与切片</a></li><li><a href="/basic/function.html" class="sidebar-link">函数与指针</a></li><li><a href="/basic/struct.html" aria-current="page" class="active sidebar-link">结构体与方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/struct.html#结构体" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/struct.html#声明结构体" class="sidebar-link">声明结构体</a></li><li class="sidebar-sub-header"><a href="/basic/struct.html#初始化结构体" class="sidebar-link">初始化结构体</a></li><li class="sidebar-sub-header"><a href="/basic/struct.html#匿名结构体" class="sidebar-link">匿名结构体</a></li></ul></li><li class="sidebar-sub-header"><a href="/basic/struct.html#方法" class="sidebar-link">方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/struct.html#方法的集合" class="sidebar-link">方法的集合</a></li><li class="sidebar-sub-header"><a href="/basic/struct.html#方法中的指针" class="sidebar-link">方法中的指针</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>实战</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="结构体与方法"><a href="#结构体与方法" class="header-anchor">#</a> 结构体与方法</h1> <h2 id="结构体"><a href="#结构体" class="header-anchor">#</a> 结构体</h2> <p>结构体是 go 语言中一个比较重要的概念，在 c 语言中也有类似的东西。由于他们没有类的概念，结构体可以简单理解成类，是一个不同类型的数据构成的一个集合。集合中不同类型的数据被称为成员，每个成员都要自己不同的类型，可以理解为 js 中对象的每个属性。</p> <h3 id="声明结构体"><a href="#声明结构体" class="header-anchor">#</a> 声明结构体</h3> <p>结构体通过 <code>type</code> 和 <code>struct</code> 关键字进行声明，<code>type</code> 后接结构体的名字，<code>struct</code> 后接结构体每个成员的定义。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  name <span class="token builtin">string</span>
  age <span class="token builtin">int</span>
  gender <span class="token builtin">string</span>
  address <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码有点类似于其他语言中接口的定义，实际上，go 也支持定义接口，我们只需要将 <code>struct</code> 关键字替换成 <code>interface</code> 就表示定义接口。</p> <h3 id="初始化结构体"><a href="#初始化结构体" class="header-anchor">#</a> 初始化结构体</h3> <p>初始化结构体有两种方式，一种是通过字面量的方式，用结构体名称加上结构体各个成员值的方式进行初始化。用上面的 <code>Person</code> 结构体举例：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> p <span class="token operator">=</span> Person<span class="token punctuation">{</span><span class="token string">&quot;Shenfq&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;湖南长沙&quot;</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Person:&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
</code></pre></div><p><img src="https://file.shenfq.com/pic/20210418162456.png" alt=""></p> <p>这种方式需要每个值按照结构体成员定义时的顺序进行初始化，当然，也可以通过键值对的方式，打乱其顺序。这种方式可以对部分成员进行省略，省略的部分会根据其类型，取该类型的空值。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> p <span class="token operator">=</span> Person<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;Shenfq&quot;</span><span class="token punctuation">,</span>
  address<span class="token punctuation">:</span> <span class="token string">&quot;湖南长沙&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Person:&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Person.age:&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
</code></pre></div><p>如果要访问结构体成员，可以通过 <code>.</code> 操作符，这与其他语言取对象属性的方式一致。这里我们使用 <code>p.age</code> 的方式获取了结构体 <code>p</code> 的成员 <code>age</code> 的值。</p> <p><img src="https://file.shenfq.com/pic/20210418162725.png" alt=""></p> <p>除了字面量的方式初始化，结构体还可以通过 <code>new</code> 关键字进行初始化。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span>
</code></pre></div><p>通过该方式初始化的结构体有两个特点：</p> <ul><li>new 关键字返回的为结构体指针；</li> <li>new 关键字返回的结果每个成员都是空值；</li></ul> <p>所以，我们通过 <code>new</code> 初始化结构体的时候，取值的时候需要加 <code>*</code> 号。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Shenfq&quot;</span>
p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>
p<span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token string">&quot;男&quot;</span>
p<span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token string">&quot;湖南长沙&quot;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Person:&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
</code></pre></div><p>如果直接在控制台打印变量 <code>p</code>，会发现前面有个 <code>&amp;</code>，表示这是一个指针。</p> <p><img src="https://file.shenfq.com/pic/20210418204339.png" alt=""></p> <h3 id="匿名结构体"><a href="#匿名结构体" class="header-anchor">#</a> 匿名结构体</h3> <p>结构体和函数一样也可以定义一个没有名字的结构体，就是在定义结构体的同时进行初始化，并且省略 <code>type</code> 关键字和结构体名称。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  name <span class="token builtin">string</span>
  age <span class="token builtin">int</span>
  gender <span class="token builtin">string</span>
  address <span class="token builtin">string</span>
<span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token string">&quot;Shenfq&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;湖南长沙&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h2> <p>结构体只能定义一个个成员，而且成员都是基础类型，想要实现类似 OOP 中类的概念，还需要为结构体提供方法。实际上，我们可以为结构体指定方法，只需要在定义函数的函数名前面加上结构体名，就能定义该函数为结构体的方法。</p> <p>我们为之前的 <code>Person</code> 结构体定义一个 <code>sayHello</code> 的方法。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>p Person<span class="token punctuation">)</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Hi %s, I'm %s, How are you?\n&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
p<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>调用结构体方法的方式，和取结构体成员的值一样，也需要通过 <code>.</code> 操作符。</p> <p><img src="https://file.shenfq.com/pic/20210419103247.png" alt=""></p> <p>在 goland 的 Structure 中，能看到 <code>Person</code> 结构体是包含 <code>sayHello</code> 方法的，说明方法的定义即使不在结构体内，这个方法也是属于该结构体的。</p> <p><img src="https://file.shenfq.com/pic/20210419141849.png" alt=""></p> <h3 id="方法的集合"><a href="#方法的集合" class="header-anchor">#</a> 方法的集合</h3> <p>前面介绍过，多个成员变量可以组成一个结构体，而多个方法的集合可以组成一个接口，这是一种比较抽象的类型。接口的声明与结构体类似，只需要将 <code>struct</code> 关键字替换为 <code>interface</code> 即可。</p> <p>现在我们，声明了一个 <code>Human</code> 接口，其中有一个 <code>hello</code> 方法。并提供一个函数，该函数接受第一个参数类型为 <code>Human</code>，在其中调用了它的 <code>hello</code> 方法。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Human <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>h Human<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，声明了两个结构体 <code>Student</code> 和 <code>Teacher</code>，这两个结构体都实现了 <code>hello</code> 方法。虽然没有明确将这两个结构体与 <code>Human</code> 接口绑定，但是这两个结构体实质上将 <code>Human</code> 接口进行了实现，这是一种非入侵式的设计。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Student <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Teacher <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s Student<span class="token punctuation">)</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Hi, I'm %s&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t Teacher<span class="token punctuation">)</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Hi, I'm %s&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来定义了两个变量为 <code>s</code>、<code>t</code>，这两个变量分别是 <code>Student</code> 和 <code>Teacher</code>结构体的实现。在声明阶段，可以指定这两个变量为 <code>Human</code> 的实现，因为 <code>Student</code> 和 <code>Teacher</code> 确实都实现了 <code>hello</code> 方法，满足 <code>Human</code> 的定义。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> s Human <span class="token operator">=</span> Student<span class="token punctuation">{</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> t Human <span class="token operator">=</span> Teacher<span class="token punctuation">{</span><span class="token string">&quot;Frank&quot;</span><span class="token punctuation">}</span>

<span class="token function">sayHello</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token function">sayHello</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
</code></pre></div><p>而我们最后调用 <code>sayHello</code> 函数，也可以正常运行。</p> <p><img src="https://file.shenfq.com/pic/20210429115318.png" alt=""></p> <p>这就类似于面向对象中多态的概念，<code>sayHello</code> 函数在运行的时候，不管参数 <code>h</code> 具体有哪些成员和方法，只要知道参数 <code>h</code> 实现了 <code>hello</code> 方法就能正常运行。</p> <h3 id="方法中的指针"><a href="#方法中的指针" class="header-anchor">#</a> 方法中的指针</h3> <p>有时候，我们调用方法的同时，需要修改结构体中一些成员的值，会发现原结构体的值并没有改变。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>p Person<span class="token punctuation">)</span> <span class="token function">growth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p<span class="token punctuation">.</span>age<span class="token operator">++</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> p <span class="token operator">=</span> Person<span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
p<span class="token punctuation">.</span><span class="token function">growth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>上面的代码中，我们定义的 <code>growth</code> 方法，会修改传入结构体中的 <code>age</code> 值。但是实际结果和我们预期的不一样。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> p <span class="token operator">=</span> Person<span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

p<span class="token punctuation">.</span><span class="token function">growth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;age:&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
</code></pre></div><p><img src="https://file.shenfq.com/pic/20210419161602.png" alt=""></p> <p>这是由于，传入方法中的结构体，是原结构体复制后的值，需要修改原结构体，就需要给方法传入其指针。只需要在方法定义结构体参数时，加上 <code>*</code> 号，表示变量 <code>p</code> 为结构体指针。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">growth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p<span class="token punctuation">.</span>age<span class="token operator">++</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://file.shenfq.com/pic/20210419161824.png" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">4/29/2021, 8:46:09 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/basic/function.html" class="prev">
        函数与指针
      </a></span> <span class="next"><a href="/advance/error.html">
        错误处理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7d3f5bbc.js" defer></script><script src="/assets/js/2.9a822252.js" defer></script><script src="/assets/js/14.523577e2.js" defer></script>
  </body>
</html>
